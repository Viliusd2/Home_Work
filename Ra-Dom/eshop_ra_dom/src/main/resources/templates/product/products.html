<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="en">
<head th:replace="fragments/layout :: head(#{products.header})"></head>
<body>

<div th:replace="fragments/layout :: navbar(rootPath='list')">Cia yra navbar (menu)</div>
<div class="card card__main">
    <div th:align="center">
        <h2 th:text="#{products.header}"></h2>
        <div th:if="${not productsPage.hasContent()}" th:text="#{products.empty.message}"></div>
    </div>
    <div th:with="urlRootPath=${#httpServletRequest.requestURI}">
        <div th:if="${productsPage.hasContent()}"
             class="container">
            <div th:replace="fragments/messages :: message"></div>

            <div class="cards">
                <div class="card" th:each="product: ${productsPage}">
                    <img th:src="@{/images/logo.png}" alt="" class="card__image">
                    <div class="card__content">
                        <div th:text="#{products.name}"></div>
                        <div><a th:href="@{/products/{productId}/update(productId=${product.productId})}"
                                th:text="${product.name}"></a></div>
                        <div class="card__content_inside">
                            <div>
                                <div th:text="#{products.quantity}"></div>
                                <div th:text="#{products.price}"></div>
                            </div>
                            <div>
                                <div th:text="${product.quantityInStock}"></div>
                                <div th:text="${product.price}"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card__info">
                            <form method="POST"
                                  th:action="@{{path}(path=${cartPath} + '/' + ${product.productId})}">
                                <button class="btn btn-primary">
                                    <i class="fa-solid fa-cart-arrow-down"></i>
                                </button>
                            </form>
                            <div sec:authorize="hasRole('ADMIN')">
                                <form method="POST" th:action="@{/products/delete}">
                                    <input type="hidden" name="productId" th:value="${product.productId}">
                                    <button class="btn btn-danger" th:text="#{products.delete}"></button>
                                </form>
                            </div>

                    </div>
                </div>
            </div>
            <span th:text="#{products.all(${productsPage.totalElements})}"></span>
        </div>
    </div>

    <nav class="d-flex justify-content-center">
        <ul class="pagination"
            th:with="
                orderParam=${productsPage.sort.iterator().hasNext() ? productsPage.sort.iterator().next : null},
                sortParam=${orderParam ne null ? orderParam.property + ',' + orderParam.direction + ',ignorecase' : null}">

            <li class="page-item"
                th:classappend="${!productsPage.hasPrevious()} ? 'disabled'"
            >
                <a class="page-link"
                   th:href="@{*{urlRootPath}(page=${productsPage.number} - 1,sort=${sortParam})}"
                   th:text="#{products.previous}"
                ></a>
            </li>
            <li class="page-item"
                th:each="pageNumber: ${#numbers.sequence(0, productsPage.totalPages - 1)}"
                th:classappend="${pageNumber == productsPage.number ? 'active' : ''}"
            >
                <a class="page-link"
                   th:href="@{*{urlRootPath}(page=${pageNumber},sort=${sortParam})}"
                   th:text="${pageNumber + 1}"></a>
            </li>
            <li class="page-item"
                th:classappend="${!productsPage.hasNext()} ? 'disabled'"
            >
                <a class="page-link"
                   th:href="@{*{urlRootPath}(page=${productsPage.number} + 1,sort=${sortParam})}"
                   th:text="#{products.next}"
                ></a>
            </li>
        </ul>
    </nav>

</div>

<div th:replace="fragments/layout :: footer"></div>

</body>
</html>
